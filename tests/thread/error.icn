
global gsum, mutex_gsum


procedure main(argv)
   gsum:=0
   thrd:=[]

   if *argv>0 then
      n:=integer(argv[1]) | stop ("arg must be integer")
    else
      n:=1
  
   d:=10^2 / n
   every i:=1 to n do{
     th := create suma(d, i)
     put(thrd, th)
     }

   mutex_gsum := mutex()
  
   write("running ", *thrd , " thread(s) please wait... ")

   t:=&now
   every i:=1 to *thrd do
      thread(thrd[i])

   every i:=1 to *thrd do
      join(thrd[i])

   write("sum=",gsum)
   
   write("time:", &now-t, " seconds")
end


procedure suma(n, id)
   local sum, error_null
    sum:=0
    every i:=1 to n do
      sum+:=1

    sum := sum + error_null   
   
   lock(mutex_gsum)
   gsum +:= sum
   unlock(mutex_gsum)

   write("Thread ", id , " is done")
end
